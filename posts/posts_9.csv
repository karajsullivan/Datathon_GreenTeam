,Post ID,Discussion Group,Author,Author Label,Topic,Body,Likes,Replies,Tags,Labels,Solution Link,Date,Time
0,506528,Cloud NGFW Discussions,SZanpure,L2 Linker,Terraform provider inconsistencies and issues with IAM role tags,"Hi,Â I am currently on provider version 1.0.4 (prior to this, I was trialling out CloudNGFW a month ago, on locally built version 1.0.0 of the provider). I do not think it's a provider bug as such, but the issues I am facing pertain to provider block configuration.Before I list the issues, I would like to provide some info on the pre-requisite steps I have completed prior to deploying NGFW via terraform.Â 1. I have subscribed to CloudNGFW via AWS Marketplace.2. I have added my sandbox account to CloudNGFW tenant via Web UI and I have run the Cloudformation template. I am using Customer managed endpoints.3. I have created the Cloudwatch Log groups and log streams matching the names in the CT above.4. I have switched on programmatic access and followed the guide to create IAM role and policy. I have added all 3 tags on my IAM role as shown belowWith this in place, here are my findings:Â Scenario 1: Running locally built provider version 1.0.0, I could bootstrap the cloudngfwaws provider as suchÂ Â This worked flawlessly, and I did not have to specify any access_key or secret_key. The provider would lookup the AWS credentials automatically (not sure how. Possibly by looking at AWS_PROFILE environment variable or the likes).Â Scenario 2: Fast forward a month, and today I started working on this project again, and upgraded to provider version 1.0.4 from Terraform registry, instead of building it locally. Below are the issues I noticed:Â Issue 1:Â If access_key and secret_key are not supplied in provider_config (json file), I get the following error upon running terraform plan:Â Â This issue was NOT for AWS provider, but for the cloudngfwaws provider. So I decided to add access_key and secret_key into the provider config block, which led me to issue 2Â Issue 2:Â After supplying the info above, I ran terraform plan, and got the following error:Â Â The clue here is ""CloudNGFWGlobalRulestackAdmin role is not supported"". My terraform code is rather simple. It creates a standard NGFW, with a local rulestack, that has a local security rule defined underneath. I do not want or have a global rulestack. However, the IAM role created in the pre-requisite steps has the ""CloudNGFWGlobalRulestackAdmin"" tag associated with it. If that tag is defined, it seems to force a dependency on the NGFW being configured in AWS FMS with a matching policy. This is not mentioned anywhere in the docs as far as I can see, though I might have missed it.Â Another thing to note here, is that I attempted to delete the tag from IAM policy in terraform and tried to run terraform plan, but the NGFW provider was not letting me apply that change (terraform plan failed preventing me from proceeding). So I had to manually login to AWS console and delete that tag from IAM policy. This leads me to the next issue.Â Issue 3:Â After deleting the tag via AWS console, and deleting it in terraform code, I ran terraform plan again. This time I got a new errorÂ Â Â This threw me off because I am not creating global rules anywhere and I had already fixed the IAM role above. So I read through the provider docs, and it turns out that if I supply the provider settings ""arn"" in config block, it tries to generate/refresh all tokens (localfirewalladmin, localrulestackadmin and globalrulestackadmin). So I removed ""arn"" and instead supplied ""lfa_arn"" and ""lra_arn"" in my config block. This led me to my next issue.Â Issue 4:Â Now, after running terraform plan, I got the following error. Please note that my config was supplied in json file.Â Â This is definitely incorrect, since the ARN's are specified.Â Â So I read the provider docs again, and the config block resolution seems to look for properties in the provider block first, followed by ENV variables, and then in the json file. So I moved all the above config from json file to provider block directly, and at this point, terraform plan finally gave me an output. I have yet to run terraform apply.Â The point of all this is to note that changes in backend functionality are breaking the provider, and the documentation does not match the backend. These nuances of access_key and secret_key being mandatory, when to use arn vs lfa/lra arn and IAM role tags effectively being used to suss out centralised vs distributed deployment (and AWS FMS therefore being needed for distributed deployment) need to be documented better.Â Â Please let me know if I have missed some relevant documentation, and I will be happy to read it ðŸ™‚Â Thanks,Shreyas",0,"
		6 REPLIES 6
",", aws, Cloud NGFW, Cloud NGFW for AWS, terraform",,,06-27-2022,11:35 AM
1,,Cloud NGFW Discussions,SZanpure,,,,,,,", Cloud NGFW, Cloud NGFW for AWS",,,
2,507132,Cloud NGFW Discussions,SZanpure,L2 Linker,Deploy NGFW in eu-west-2,"Hi,Â I am trying to deploy NGFW in eu-west-2, but it's failing on the Cloudformation template. Steps below:1. Subscribe to NGFW via AWS Marketplace (which is global and not per region).2. Click on the verification email and set up new password. Then login.3. Go to Add account, and then launch cloudformation termplate.Â Â At this point, the template opens up in us-east-1 region by default, and changing the region to eu-west-2 in AWS console does not change the cloudformation template parameter values (Trusted Account ID, ExternalID and SNS). Deploying the template with these values failsOne thing I want to try is change the region in NGFW Web UI first (In the Rulestack/NGFW section), and then click Add Account to see if it makes a difference. Again, I could not find anything in the docs about this, but I could be looking in the wrong place.This would be mean I have to un-subscribe, wait for an hour and re-subscribe. While I wait, any suggestions about what I might be missing please?Â Thanks,Shreyas",0,"
		8 REPLIES 8
",", aws, Cloud NGFW",,https://live.paloaltonetworks.com//t5/cloud-ngfw-discussions/deploy-ngfw-in-eu-west-2/m-p/507253#M339,06-29-2022,08:47 AM
3,504890,Cloud NGFW Discussions,crippste,L0 Member,Create local rulestacks with Terraform for firewall manager account.,"Hello,Â We have created a distributed firewall using firewall manager and created global rulestacks using the api.Â Now we would like to create local rule stacks via terraform but are running into issues as the account was onboarded using firewall manager.Â Does anyone know if both local and global rulestacks are supported via the api if the account was onboarded using firewall manager?",0,"
		1 REPLY 1
",,,,06-20-2022,03:50 AM
4,505408,Cloud NGFW Discussions,SGopal11,L1 Bithead,Cloud NGFW resetting or dropping traffic  (app shows incomplete) although the traffic is fine when NGFW bypassed,Cloud NGFW resetting or dropping traffic (app shows incomplete) although the traffic is fine when NGFW bypassedTÂ Â Â ,0,"
		4 REPLIES 4
",,,,06-22-2022,07:44 AM
5,503128,Cloud NGFW Discussions,MWhittaker,L1 Bithead,"cloud ngfw and resources stuck in ""DELETING"" stage - post onboarding the tenant account to AWS FMS","My attempt to delete a cloud NGFW instance is stuck. This was a standalone tenant account that i upgraded to an AWS administrator account and introduced AWS FMS to the mix. The issue is this.1. When you upgrade a standalone tenant account to an admin account for AWS FMS onboarding, deleting the existing/newly created (?) NGFW resource goes for a whack.2. After waiting for an hour, i ended up deleting the stackset and the endpoint from my account thinking i need to clean up my account before the ngfw firewall resource will be cleaned up.3. I even revoked the admin access for my AWS account to make sure everything is clean from my side and then upgraded my account to administrator account again to try set things right. But no luck!4. The one thing that i noticed is that if i get to the ""Firewall Settings"" page, i get an error ""Account XXXX does not exist as a member"".Â 5. I cannot add another AWS account now since the account is already onboarded (and i get a prompt popup mentioning the same)Somewhere, a disconnect/access permission issue makes it harder for the ngfw resources to get stuck in deleting state.Â ",0,"
		7 REPLIES 7
",", aws, Cloud NGFW, Cloud NGFW for AWS",,https://live.paloaltonetworks.com//t5/cloud-ngfw-discussions/cloud-ngfw-and-resources-stuck-in-quot-deleting-quot-stage-post/m-p/503345#M319,06-13-2022,06:49 AM
6,503435,Cloud NGFW Discussions,MWhittaker,L1 Bithead,Unsubscribe option for cloud NGFW,"How do i unsubscribe cloud NGFW service from the current IAM account and subscribe with a different account? There is no ""unsubscribe"" option either in the portal or via AWS console. Am in missing something?Â ",0,"
		1 REPLY 1
",,,https://live.paloaltonetworks.com//t5/cloud-ngfw-discussions/unsubscribe-option-for-cloud-ngfw/m-p/503921#M323,06-14-2022,02:36 AM
7,490183,Cloud NGFW Discussions,nattapong_thi,L1 Bithead,Deleting AWS account from Cloud NGFW Portal,"After tried to delete AWS account inside CloudNGFW portal, Now status is ""deleting"" for 4 hours alreadyIs it take so long time?Â I can not add a new account, It seem support onboard only 1 account",0,"
		6 REPLIES 6
",", aws, Cloud NGFW, Cloud NGFW for AWS, cloudngfw",,https://live.paloaltonetworks.com//t5/cloud-ngfw-discussions/deleting-aws-account-from-cloud-ngfw-portal/m-p/496012#M310,05-24-2022,12:11 AM
8,499059,Cloud NGFW Discussions,EObert,L0 Member,"Your membership has expired or has not been approved, please contact Palo Alto Networks Support.","Hi,while login to CSP I've got the message:UnAuthorized AccessÂ How to proceed next ?Â /rgdsEva-MariaÂ ",0,"
		2 REPLIES 2
",", Cloud NGFW, Cloud NGFW for AWS",,,06-03-2022,01:54 AM
9,487924,Cloud NGFW Discussions,JFruitt,L0 Member,NGFW Rulestacks - custom objects not available,Looking to create a custom object but it doesn't show as an available option.Â  I have an AWS pay as you go account.Â  What am I missing?Â ,0,"
		1 REPLY 1
",", aws, Cloud NGFW for AWS",,,05-17-2022,12:16 PM
10,483472,Cloud NGFW Discussions,SZanpure,L2 Linker,Terraform NGFW provider failing to get token for CloudFirewallAdmin,"Hi,Â I am trialling out the TF provider in thisÂ repoÂ and I have successfully built the provider locally. I am able to configure it as per the settings mentioned in the doc. To give a brief overview, I haveÂ  Â  Â  Â  Â  Key=NGFWaasRole, Value=CloudFirewallAdminÂ  Â  Â  Â  Â  Key=NGFWaasRole, Value=CloudRulestackAdminÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â host:Â ""api.us-east-1.aws.cloudngfw.paloaltonetworks.com""Â  Â  Â  Â  Â  Â  Â  Â  Â  Â region: ""us-east-1""Â  Â  Â  Â  Â  Â  Â  Â  Â  Â arn: ""<The arn of the API Gateway IAM Role I setup in step 3>""Â The provider initialises successfully when I run terraform init, however when I run terraform plan, it errors as per the screenshot belowÂ I can only speculate (since I am not familiar with golang, but the code for ngfw client isÂ hereÂ ) that the client is failing to execute steps 8 and 9 mentionedÂ hereÂ Â Another thing to note is that the tags mentioned in step 5 of the above article are different from the ones you have mentioned in the linked ticket above. Is there any reason for this difference? Also, the Github repo linked in step 6 has a broken link, so I cannot view the CFT examples.Â Â Any help would be appreciated since I am now effectively blocked in automating the NGFW firewall creation.Â Regards,ShreyasÂ  Â  Â  Â  Â  Â  Â  Â  Â Â Â ",1,"
		24 REPLIES 24
",", aws, Cloud NGFW, Cloud NGFW for AWS",,,04-28-2022,01:49 AM
11,478170,Cloud NGFW Discussions,hparandekar,L0 Member,Programmatic Access for Cloud NGFW,"Where can I find more information about programmatic access for Cloud NGFW? Also can I use AWS Cloudformation Templates to create and manage Cloud NGFW resources?Â Note that I have already enabled the ""Programmatic Access"" button in the Cloud NGFW UI.",0,"
		1 REPLY 1
",", aws, Cloud NGFW, Cloud NGFW for AWS",,,04-04-2022,06:27 PM
12,475650,Cloud NGFW Discussions,apatil,L3 Networker,What is a RuleStack?,,1,"
		2 REPLIES 2
",", Cloud NGFW for AWS",,,03-24-2022,04:04 PM
13,475680,Cloud NGFW Discussions,tzahroof,L2 Linker,Where can I find more information about a threat signature?,"If I have seen a threat in my logs, where can I go to find out more information?",0,"
		2 REPLIES 2
",", aws, Cloud NGFW, Cloud NGFW for AWS, threat signatures",", Cloud NGFW",https://live.paloaltonetworks.com//t5/cloud-ngfw-discussions/where-can-i-find-more-information-about-a-threat-signature/m-p/475918#M266,03-24-2022,06:46 PM
14,475679,Cloud NGFW Discussions,tzahroof,L2 Linker,What apps can I specify with App-ID?,"As listed in the subject, what apps can I use with App-ID? Is there a place where I can see an up-to-date list of apps?",0,"
		2 REPLIES 2
",", Cloud NGFW for AWS",", Cloud NGFW, Cloud NGFW for AWS",https://live.paloaltonetworks.com//t5/cloud-ngfw-discussions/what-apps-can-i-specify-with-app-id/m-p/476299#M268,03-24-2022,06:45 PM
15,475653,Cloud NGFW Discussions,apatil,L3 Networker,Where can I find the list of URL categories ?,,0,"
		2 REPLIES 2
",", Cloud NGFW for AWS, logging and reporting, url, URL categories, url category",,https://live.paloaltonetworks.com//t5/cloud-ngfw-discussions/where-can-i-find-the-list-of-url-categories/m-p/476298#M267,03-24-2022,04:06 PM
